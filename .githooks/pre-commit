#!/usr/bin/env bash
set -euo pipefail

if ! command -v clang-format >/dev/null 2>&1; then
    echo "pre-commit: clang-format not found in PATH"
    exit 1
fi

mapfile -t files < <(
    git diff --cached --name-only --diff-filter=ACMR \
    | grep -E '\.(c|cc|cpp|cxx|h|hh|hpp|hxx)$' || true
)

if [ ${#files[@]} -eq 0 ]; then
    exit 0
fi

clang-format -i "${files[@]}"
git add "${files[@]}"

echo "pre-commit: formatted and restaged ${#files[@]} C/C++ file(s)"
