services:
  build:
    build:
      context: .
      dockerfile: Dockerfile.build
    image: wordle-pp-build
    working_dir: /src
    volumes:
      - .:/src
    command:
      - em++
      - -std=c++17
      - -O3
      - -Icpp-logic/include
      - --preload-file
      - wordLists/answerlist.txt
      - --preload-file
      - wordLists/guesslist.txt
      - cpp-logic/src/wasm_exports.cpp
      - cpp-logic/src/engine.cpp
      - -o
      - frontend/wordle.js
      - -s
      - WASM=1
      - -s
      - EXPORTED_FUNCTIONS=["_createNewGame","_makeGuess","_validateGuess","_makeHardModeGuess","_freeCString","_free","_malloc"]
      - -s
      - EXPORTED_RUNTIME_METHODS=["ccall","cwrap","UTF8ToString","stringToUTF8","setValue"]

  web:
    image: nginx:1.27-alpine
    ports:
      - "8080:80"
    volumes:
      - ./frontend:/usr/share/nginx/html:ro
